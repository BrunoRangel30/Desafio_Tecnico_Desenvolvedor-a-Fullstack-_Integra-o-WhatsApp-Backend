// schema.prisma
datasource db {
  provider = "postgresql" // ou mysql/sqlite/mongodb conforme seu projeto
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model WhatsAppSession {
  id          String         @id @default(uuid())
  sessionId   String         @unique
  status      String         // pending | waiting_qr | connected | expired | error
  qrCode      String?        // QR gerado para autenticação
  pairingCode String?        // alternativa ao QR
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  conversations Conversation[]
}

model Conversation {
  id        String   @id @default(uuid())
  contact   String   // número do cliente (ex: +5511999999999)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sessionId String
  session   WhatsAppSession @relation(fields: [sessionId], references: [id])

  messages  Message[]
}

model Message {
  id          String   @id @default(uuid())
  from        String   // número de origem
  to          String   // número de destino
  body        String
  direction   String   // "sent" | "received"
  generatedBy String?  // "user" | "ai" | null
  timestamp   DateTime @default(now())

  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
}
